(()=>{"use strict";class e{constructor(e){this.length=e,this.numOfHits=0,this.isSunk=!1,this.positions=[]}setPositions(e){this.positions=e}hit(){this.numOfHits+=1,this.checkIsSunk()}checkIsSunk(){this.numOfHits>=this.length&&(this.isSunk=!0)}getIsSunk(){return this.isSunk}}class t{constructor(){this.size=10,this.board=this.createBoard(this.size),this.numOfShips=5,this.numOfSunken=0,this.ships=[]}createBoard(e){const t=[];for(let a=0;a<e;a++)t[a]=new Array(e).fill(null);return t}placeShip(e,t,a,r){const n=e.length,s=[];for(let e=0;e<n;e++)if("right"===r){if(null!==this.board[t][a+e])throw new Error(`Collision detected at (${t}, ${a+e}). Ship cannot be placed.`);s.push([t,a+e])}else if("down"===r){if(null!==this.board[t+e][a])throw new Error(`Collision detected at (${t+e}, ${a}). Ship cannot be placed.`);s.push([t+e,a])}for(let s=0;s<n;s++)"right"===r?this.board[t][a+s]=e:"down"===r&&(this.board[t+s][a]=e);e.setPositions(s),this.ships.push(e)}receiveAttack(t,a){const r=this.board[t][a];null===r?this.board[t][a]="R":r instanceof e&&(r.hit(),this.board[t][a]="H",r.getIsSunk()&&this.incrementSunken())}incrementSunken(){if(this.numOfSunken++,this.numOfSunken>=this.numOfShips)return"Game Over! All ships have been sunk."}isGameover(){return this.numOfSunken>=this.numOfShips}logBoard(){console.log("Gameboard:");for(let e of this.board)console.log(e.map((e=>null===e?".":"S")).join(" "))}logBoardTable(){console.table(this.board.map((t=>t.map((t=>"H"===t?"H":"R"===t?"R":t instanceof e?"S":".")))))}}class a{constructor(e){"computer"===e?this.initCompter():"human"===e&&this.initPlayer()}initPlayer(){this.gameboard=new t}initCompter(){this.gameboard=new t,[5,4,3,3,2].forEach((t=>{let a=!1;for(;!a;){const r=Math.floor(Math.random()*this.gameboard.size),n=Math.floor(Math.random()*this.gameboard.size),s=Math.random()<.5?"right":"down",i=new e(t);try{this.gameboard.placeShip(i,r,n,s),a=!0}catch(e){}}}))}}const r={renderHomeScreen(){const e=document.querySelector("body");e.innerHTML="";const t=document.createElement("header");t.innerText="Battleship Game",e.appendChild(t);const a=document.createElement("div");a.classList.add("game-container");const r=document.createElement("div");r.classList.add("player-container");const n=document.createElement("h2");n.innerText="Player 1";const s=document.createElement("div");s.id="player1-board",s.classList.add("gameboard"),r.appendChild(n),r.appendChild(s);const i=document.createElement("div");i.classList.add("player-container");const o=document.createElement("h2");o.innerText="Player 2";const h=document.createElement("div");h.id="player2-board",h.classList.add("gameboard"),i.appendChild(o),i.appendChild(h),a.appendChild(r),a.appendChild(i),e.appendChild(a)},updateBoardUI(t,a,r){const n=document.getElementById(`${a}-board`);n.innerHTML="",t.board.forEach(((t,a)=>{const s=document.createElement("div");s.classList.add("row"),t.forEach(((t,n)=>{const i=document.createElement("div");i.classList.add("cell"),i.dataset.x=a,i.dataset.y=n,"H"===t?i.classList.add("hit"):"R"===t?i.classList.add("revealed"):r&&t instanceof e?i.classList.add("ship"):i.classList.add("empty"),s.appendChild(i)})),n.appendChild(s)}))},bindBoardClickEvents(e,t){document.getElementById(`${e}-board`).addEventListener("click",(e=>{if(e.target.classList.contains("cell")){const a=e.target.dataset.x,r=e.target.dataset.y;t(a,r)}}))}};(new class{constructor(){this.humanPlayer=new a("human"),this.computerPlayer=new a("computer"),this.currentPlayer=this.humanPlayer}startGame(){r.renderHomeScreen(),this.humanPlayer.gameboard.placeShip(new e(5),2,2,"right"),this.humanPlayer.gameboard.placeShip(new e(4),5,4,"down"),this.humanPlayer.gameboard.placeShip(new e(3),8,7,"right"),this.humanPlayer.gameboard.placeShip(new e(3),0,0,"down"),this.humanPlayer.gameboard.placeShip(new e(2),6,6,"down"),this.updateUI(),r.bindBoardClickEvents("player2",((e,t)=>{this.humanTurn(e,t)}))}humanTurn(e,t){this.currentPlayer===this.humanPlayer&&(this.humanPlayer.gameboard.receiveAttack(e,t),this.updateUI(),this.humanPlayer.gameboard.isGameover()?alert("You win! All enemy ships have been sunk."):(this.currentPlayer=this.computerPlayer,setTimeout((()=>this.computerTurn()),1e3)))}computerTurn(){if(this.currentPlayer!==this.computerPlayer)return;let e,t;do{e=Math.floor(Math.random()*this.humanPlayer.gameboard.size),t=Math.floor(Math.random()*this.humanPlayer.gameboard.size)}while(null!==this.humanPlayer.gameboard.board[e][t]);this.computerPlayer.gameboard.receiveAttack(e,t),this.updateUI(),this.computerPlayer.gameboard.isGameover()?alert("Computer wins! All your ships have been sunk."):this.currentPlayer=this.humanPlayer}updateUI(){r.updateBoardUI(this.humanPlayer.gameboard,"player1",!0),r.updateBoardUI(this.computerPlayer.gameboard,"player2",!1)}}).startGame(),r.bindBoardClickEvents("player2",((e,t)=>{computer.gameboard.receiveAttack(e,t),r.updateBoardUI(computer.gameboard,"player2")}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cUYsZ0JBQWtCckYsS0FBS29GLGVBQWdCLE9BRWhELElBQUloRSxFQUFHQyxFQUNQLEdBQ0lELEVBQUl5QixLQUFLQyxNQUFNRCxLQUFLRSxTQUFXL0MsS0FBS21GLFlBQVl6QyxVQUFVakMsTUFDMURZLEVBQUl3QixLQUFLQyxNQUFNRCxLQUFLRSxTQUFXL0MsS0FBS21GLFlBQVl6QyxVQUFVakMsWUFDVixPQUEzQ1QsS0FBS21GLFlBQVl6QyxVQUFVaEMsTUFBTVUsR0FBR0MsSUFFN0NyQixLQUFLb0YsZUFBZTFDLFVBQVVoQixjQUFjTixFQUFHQyxHQUMvQ3JCLEtBQUt1RixXQUVEdkYsS0FBS29GLGVBQWUxQyxVQUFVYixhQUM5QjRELE1BQU0saURBSVZ6RixLQUFLcUYsY0FBZ0JyRixLQUFLbUYsV0FDOUIsQ0FHQSxRQUFBSSxHQUNJdEMsRUFBVW9CLGNBQWNyRSxLQUFLbUYsWUFBWXpDLFVBQVcsV0FBVyxHQUMvRE8sRUFBVW9CLGNBQWNyRSxLQUFLb0YsZUFBZTFDLFVBQVcsV0FBVyxFQUN0RSxJRGhFVzRDLFlBR2ZyQyxFQUFVNEIscUJBQXFCLFdBQVcsQ0FBQ3pELEVBQUdDLEtBQzFDdUUsU0FBU2xELFVBQVVoQixjQUFjTixFQUFHQyxHQUNwQzRCLEVBQVVvQixjQUFjdUIsU0FBU2xELFVBQVcsVUFBVSxHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9zaGlwLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZ2FtZWJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvcGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZG9tTW9kdWxlLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9nYW1lQ29udHJvbGxlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY2xhc3MgU2hpcHtcbiAgICBjb25zdHJ1Y3RvcihsZW5ndGgpe1xuICAgICAgICB0aGlzLmxlbmd0aCA9IGxlbmd0aDtcbiAgICAgICAgdGhpcy5udW1PZkhpdHMgPSAwO1xuICAgICAgICB0aGlzLmlzU3VuayA9IGZhbHNlO1xuICAgICAgICB0aGlzLnBvc2l0aW9ucyA9IFtdOyAvLyBBcnJheSB0byBzdG9yZSBwb3NpdGlvbnMgb2NjdXBpZWQgYnkgdGhlIHNoaXBcbiAgICB9XG5cbiAgICAvLyBBZGQgYSBtZXRob2QgdG8gc2V0IHBvc2l0aW9ucyB3aGVuIHRoZSBzaGlwIGlzIHBsYWNlZFxuICAgIHNldFBvc2l0aW9ucyhwb3NpdGlvbnMpIHtcbiAgICAgICAgdGhpcy5wb3NpdGlvbnMgPSBwb3NpdGlvbnM7XG4gICAgfVxuXG4gICAgaGl0KCl7XG4gICAgICAgIHRoaXMubnVtT2ZIaXRzICs9IDE7XG4gICAgICAgIHRoaXMuY2hlY2tJc1N1bmsoKTtcbiAgICB9XG5cbiAgICBjaGVja0lzU3Vuaygpe1xuICAgICAgICBpZih0aGlzLm51bU9mSGl0cyA+PSB0aGlzLmxlbmd0aCl7XG4gICAgICAgICAgICB0aGlzLmlzU3VuayA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRJc1N1bmsoKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNTdW5rO1xuICAgIH1cblxufSIsImltcG9ydCB7IFNoaXAgfSBmcm9tIFwiLi9zaGlwXCI7XG5cbmV4cG9ydCBjbGFzcyBHYW1lYm9hcmQge1xuICAgIGNvbnN0cnVjdG9yKCl7XG4gICAgICAgIHRoaXMuc2l6ZSA9IDEwO1xuICAgICAgICB0aGlzLmJvYXJkID0gdGhpcy5jcmVhdGVCb2FyZCh0aGlzLnNpemUpO1xuICAgICAgICB0aGlzLm51bU9mU2hpcHMgPSA1O1xuICAgICAgICB0aGlzLm51bU9mU3Vua2VuID0gMDtcbiAgICAgICAgdGhpcy5zaGlwcyA9IFtdOyBcbiAgICB9XG5cbiAgICBjcmVhdGVCb2FyZChzaXplKXtcbiAgICAgICAgY29uc3QgYm9hcmQgPSBbXTsgLy8gQ3JlYXRlIGEgbG9jYWwgdmFyaWFibGUgYGJvYXJkYFxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgc2l6ZTsgaSsrKXtcbiAgICAgICAgICAgIGJvYXJkW2ldID0gbmV3IEFycmF5KHNpemUpLmZpbGwobnVsbCk7IC8vIEluaXRpYWxpemUgZWFjaCByb3cgb2YgdGhlIGJvYXJkXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJvYXJkOyAvLyBSZXR1cm4gdGhlIGxvY2FsIHZhcmlhYmxlIGBib2FyZGBcbiAgICB9XG5cbiAgICBwbGFjZVNoaXAoc2hpcCwgeCx5LCBkaXJlY3Rpb24pe1xuICAgICAgICBjb25zdCBzaGlwTGVuZ3RoID0gc2hpcC5sZW5ndGg7XG4gICAgICAgIGNvbnN0IHBvc2l0aW9ucyA9IFtdOyAvLyBBcnJheSB0byB0cmFjayBwb3NpdGlvbnMgZm9yIHRoaXMgc2hpcFxuXG4gICAgICAgIC8vIEZpcnN0LCBjaGVjayBpZiB0aGUgc2hpcCBjYW4gYmUgcGxhY2VkIHdpdGhvdXQgY29sbGlzaW9uXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcExlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoZGlyZWN0aW9uID09PSAncmlnaHQnKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYm9hcmRbeF1beSArIGldICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQ29sbGlzaW9uIGRldGVjdGVkIGF0ICgke3h9LCAke3kgKyBpfSkuIFNoaXAgY2Fubm90IGJlIHBsYWNlZC5gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcG9zaXRpb25zLnB1c2goW3gsIHkgKyBpXSk7IC8vIFRyYWNrIHBvc2l0aW9uXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGRpcmVjdGlvbiA9PT0gJ2Rvd24nKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYm9hcmRbeCArIGldW3ldICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQ29sbGlzaW9uIGRldGVjdGVkIGF0ICgke3ggKyBpfSwgJHt5fSkuIFNoaXAgY2Fubm90IGJlIHBsYWNlZC5gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcG9zaXRpb25zLnB1c2goW3ggKyBpLCB5XSk7IC8vIFRyYWNrIHBvc2l0aW9uXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgc2hpcExlbmd0aDsgaSsrKXtcbiAgICAgICAgICAgIGlmIChkaXJlY3Rpb24gPT09ICdyaWdodCcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmJvYXJkW3hdW3kgKyBpXSA9IHNoaXA7IC8vIFBsYWNlIHRoZSBzaGlwIGhvcml6b250YWxseVxuICAgICAgICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICdkb3duJykge1xuICAgICAgICAgICAgICAgIHRoaXMuYm9hcmRbeCArIGldW3ldID0gc2hpcDsgLy8gUGxhY2UgdGhlIHNoaXAgdmVydGljYWxseVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gU3RvcmUgdGhlIHNoaXAncyBwb3NpdGlvbnMgaW4gdGhlIFNoaXAgb2JqZWN0XG4gICAgICAgIHNoaXAuc2V0UG9zaXRpb25zKHBvc2l0aW9ucyk7XG5cbiAgICAgICAgdGhpcy5zaGlwcy5wdXNoKHNoaXApO1xuICAgIH1cblxuICAgIC8vUmV2ZWFsIGNvb3JkaW5hdGU6IHBsYWNlIFwiUmV2ZWFsZWQgZm9yIHRoZSBjb29yZGluYXRlcyB0aGF0IHdhcyBjbGlja2VkIGJ1dCBkaWQgbm90IGhpdFwiXG4gICAgcmVjZWl2ZUF0dGFjayh4LHkpey8vdGFrZSBjb29yZGluYXRlcyBpblxuICAgICAgICBjb25zdCBjZWxsID0gdGhpcy5ib2FyZFt4XVt5XTtcbiAgICAgICAgaWYgKGNlbGwgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuYm9hcmRbeF1beV0gPSAnUic7IC8vICdSJyBmb3IgUmV2ZWFsZWRcbiAgICAgICAgfSBlbHNlIGlmIChjZWxsIGluc3RhbmNlb2YgU2hpcCkge1xuICAgICAgICAgICAgY2VsbC5oaXQoKTtcbiAgICAgICAgICAgIHRoaXMuYm9hcmRbeF1beV0gPSAnSCc7IC8vICdIJyBmb3IgSGl0XG5cbiAgICAgICAgICAgIGlmIChjZWxsLmdldElzU3VuaygpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbmNyZW1lbnRTdW5rZW4oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGluY3JlbWVudFN1bmtlbigpe1xuICAgICAgICB0aGlzLm51bU9mU3Vua2VuKys7XG4gICAgICAgIGlmICh0aGlzLm51bU9mU3Vua2VuID49IHRoaXMubnVtT2ZTaGlwcykge1xuICAgICAgICAgICAgcmV0dXJuICdHYW1lIE92ZXIhIEFsbCBzaGlwcyBoYXZlIGJlZW4gc3Vuay4nO1xuICAgICAgICAgICAgLy8gVE9ETzogT3B0aW9uYWxseSByZXNldCB0aGUgZ2FtZSBoZXJlXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpc0dhbWVvdmVyKCl7XG4gICAgICAgIHJldHVybiB0aGlzLm51bU9mU3Vua2VuID49IHRoaXMubnVtT2ZTaGlwcztcbiAgICB9XG5cbiAgICAvL2RlYnVnIGZ1bmN0aW9uXG4gICAgbG9nQm9hcmQoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdHYW1lYm9hcmQ6Jyk7XG4gICAgICAgIGZvciAobGV0IHJvdyBvZiB0aGlzLmJvYXJkKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyb3cubWFwKGNlbGwgPT4gY2VsbCA9PT0gbnVsbCA/ICcuJyA6ICdTJykuam9pbignICcpKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGxvZ0JvYXJkVGFibGUoKSB7XG4gICAgICAgIGNvbnNvbGUudGFibGUodGhpcy5ib2FyZC5tYXAocm93ID0+IFxuICAgICAgICAgICAgcm93Lm1hcChjZWxsID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoY2VsbCA9PT0gJ0gnKSByZXR1cm4gJ0gnOyAvLyBIaXRcbiAgICAgICAgICAgICAgICBpZiAoY2VsbCA9PT0gJ1InKSByZXR1cm4gJ1InOyAvLyBSZXZlYWxlZFxuICAgICAgICAgICAgICAgIGlmIChjZWxsIGluc3RhbmNlb2YgU2hpcCkgcmV0dXJuICdTJzsgLy8gU2hpcFxuICAgICAgICAgICAgICAgIHJldHVybiAnLic7IC8vIEVtcHR5IGNlbGxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICkpO1xuICAgIH1cbn0iLCJpbXBvcnQgeyBHYW1lYm9hcmQgfSBmcm9tIFwiLi9nYW1lYm9hcmRcIjtcbmltcG9ydCB7IFNoaXAgfSBmcm9tIFwiLi9zaGlwXCI7XG5cbmV4cG9ydCBjbGFzcyBQbGF5ZXJ7XG4gICAgY29uc3RydWN0b3IodHlwZSl7XG4gICAgICAgIGlmKHR5cGUgPT09IFwiY29tcHV0ZXJcIil7XG4gICAgICAgICAgICB0aGlzLmluaXRDb21wdGVyKCk7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJodW1hblwiKXtcbiAgICAgICAgICAgIHRoaXMuaW5pdFBsYXllcigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaW5pdFBsYXllcigpe1xuICAgICAgICB0aGlzLmdhbWVib2FyZCA9IG5ldyBHYW1lYm9hcmQoKTtcbiAgICAgICAgY29uc3Qgc2hpcExlbmd0aHMgPSBbNSwgNCwgMywgMywgMl07IFxuICAgICAgICAvL1RPRE86aW1wbGVtZW50IFxuICAgIH1cblxuICAgIGluaXRDb21wdGVyKCl7XG4gICAgICAgIHRoaXMuZ2FtZWJvYXJkID0gbmV3IEdhbWVib2FyZCgpO1xuXG4gICAgICAgIGNvbnN0IHNoaXBMZW5ndGhzID0gWzUsIDQsIDMsIDMsIDJdOyBcbiAgICAgICAgc2hpcExlbmd0aHMuZm9yRWFjaChsZW5ndGggPT4ge1xuICAgICAgICAgICAgbGV0IHBsYWNlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgICB3aGlsZSAoIXBsYWNlZCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0aGlzLmdhbWVib2FyZC5zaXplKTtcbiAgICAgICAgICAgICAgICBjb25zdCB5ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdGhpcy5nYW1lYm9hcmQuc2l6ZSk7XG4gICAgICAgICAgICAgICAgY29uc3QgZGlyZWN0aW9uID0gTWF0aC5yYW5kb20oKSA8IDAuNSA/ICdyaWdodCcgOiAnZG93bic7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBzaGlwID0gbmV3IFNoaXAobGVuZ3RoKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBUcnkgdG8gcGxhY2UgdGhlIHNoaXA7IGlmIGl0IGZhaWxzLCBjYXRjaCB0aGUgZXJyb3IgYW5kIHJldHJ5XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nYW1lYm9hcmQucGxhY2VTaGlwKHNoaXAsIHgsIHksIGRpcmVjdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIHBsYWNlZCA9IHRydWU7IC8vIElmIHRoZSBzaGlwIGlzIHN1Y2Nlc3NmdWxseSBwbGFjZWQsIGV4aXQgdGhlIGxvb3BcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGVyZSdzIGFuIGVycm9yIChlLmcuLCBjb2xsaXNpb24pLCBjb250aW51ZSB0aGUgbG9vcCB0byB0cnkgYWdhaW5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn0iLCJpbXBvcnQgeyBTaGlwIH0gZnJvbSBcIi4vc2hpcFwiO1xuXG5leHBvcnQgY29uc3QgZG9tTW9kdWxlID0ge1xuICAgIC8vIE1ldGhvZCB0byBzZXQgdXAgdGhlIGluaXRpYWwgaG9tZSBzY3JlZW4gd2l0aCBoZWFkZXJzIGFuZCB0d28gZ2FtZSBib2FyZHNcbiAgICByZW5kZXJIb21lU2NyZWVuKCkge1xuICAgICAgICBjb25zdCBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpO1xuICAgICAgICBib2R5LmlubmVySFRNTCA9ICcnOyAvLyBDbGVhciBleGlzdGluZyBjb250ZW50XG5cbiAgICAgICAgLy8gQ3JlYXRlIHRoZSBoZWFkZXJcbiAgICAgICAgY29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaGVhZGVyJyk7XG4gICAgICAgIGhlYWRlci5pbm5lclRleHQgPSAnQmF0dGxlc2hpcCBHYW1lJztcbiAgICAgICAgYm9keS5hcHBlbmRDaGlsZChoZWFkZXIpO1xuXG4gICAgICAgIC8vIENyZWF0ZSB0aGUgY29udGFpbmVyIGZvciBib3RoIGdhbWUgYm9hcmRzXG4gICAgICAgIGNvbnN0IGdhbWVDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgZ2FtZUNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdnYW1lLWNvbnRhaW5lcicpO1xuICAgICAgICBcbiAgICAgICAgLy8gQ3JlYXRlIFBsYXllciAxJ3MgZ2FtZSBib2FyZFxuICAgICAgICBjb25zdCBwbGF5ZXIxQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHBsYXllcjFDb250YWluZXIuY2xhc3NMaXN0LmFkZCgncGxheWVyLWNvbnRhaW5lcicpO1xuICAgICAgICBjb25zdCBwbGF5ZXIxTGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpO1xuICAgICAgICBwbGF5ZXIxTGFiZWwuaW5uZXJUZXh0ID0gJ1BsYXllciAxJztcbiAgICAgICAgY29uc3QgcGxheWVyMUJvYXJkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHBsYXllcjFCb2FyZC5pZCA9ICdwbGF5ZXIxLWJvYXJkJztcbiAgICAgICAgcGxheWVyMUJvYXJkLmNsYXNzTGlzdC5hZGQoJ2dhbWVib2FyZCcpO1xuICAgICAgICBwbGF5ZXIxQ29udGFpbmVyLmFwcGVuZENoaWxkKHBsYXllcjFMYWJlbCk7XG4gICAgICAgIHBsYXllcjFDb250YWluZXIuYXBwZW5kQ2hpbGQocGxheWVyMUJvYXJkKTtcblxuICAgICAgICAvLyBDcmVhdGUgUGxheWVyIDIncyBnYW1lIGJvYXJkXG4gICAgICAgIGNvbnN0IHBsYXllcjJDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgcGxheWVyMkNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdwbGF5ZXItY29udGFpbmVyJyk7XG4gICAgICAgIGNvbnN0IHBsYXllcjJMYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XG4gICAgICAgIHBsYXllcjJMYWJlbC5pbm5lclRleHQgPSAnUGxheWVyIDInO1xuICAgICAgICBjb25zdCBwbGF5ZXIyQm9hcmQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgcGxheWVyMkJvYXJkLmlkID0gJ3BsYXllcjItYm9hcmQnO1xuICAgICAgICBwbGF5ZXIyQm9hcmQuY2xhc3NMaXN0LmFkZCgnZ2FtZWJvYXJkJyk7XG4gICAgICAgIHBsYXllcjJDb250YWluZXIuYXBwZW5kQ2hpbGQocGxheWVyMkxhYmVsKTtcbiAgICAgICAgcGxheWVyMkNvbnRhaW5lci5hcHBlbmRDaGlsZChwbGF5ZXIyQm9hcmQpO1xuXG4gICAgICAgIC8vIEFwcGVuZCBib3RoIHBsYXllciBjb250YWluZXJzIHRvIHRoZSBtYWluIGdhbWUgY29udGFpbmVyXG4gICAgICAgIGdhbWVDb250YWluZXIuYXBwZW5kQ2hpbGQocGxheWVyMUNvbnRhaW5lcik7XG4gICAgICAgIGdhbWVDb250YWluZXIuYXBwZW5kQ2hpbGQocGxheWVyMkNvbnRhaW5lcik7XG5cbiAgICAgICAgLy8gQXBwZW5kIHRoZSBnYW1lIGNvbnRhaW5lciB0byB0aGUgYm9keVxuICAgICAgICBib2R5LmFwcGVuZENoaWxkKGdhbWVDb250YWluZXIpO1xuICAgIH0sXG5cbiAgICAvLyBNZXRob2QgdG8gdXBkYXRlIHRoZSBVSSBmb3IgYSBzcGVjaWZpYyBwbGF5ZXIncyBnYW1lIGJvYXJkXG4gICAgdXBkYXRlQm9hcmRVSShnYW1lYm9hcmQsIHBsYXllciwgaXNPd25Cb2FyZCkge1xuICAgICAgICBjb25zdCBib2FyZEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHtwbGF5ZXJ9LWJvYXJkYCk7XG4gICAgICAgIGJvYXJkRWxlbWVudC5pbm5lckhUTUwgPSAnJzsgLy8gQ2xlYXIgdGhlIGV4aXN0aW5nIGJvYXJkXG4gICAgICAgIFxuICAgICAgICAvLyBJdGVyYXRlIHRocm91Z2ggdGhlIGdhbWVib2FyZCBhbmQgY3JlYXRlIGNlbGxzIGJhc2VkIG9uIHRoZSBzdGF0ZVxuICAgICAgICBnYW1lYm9hcmQuYm9hcmQuZm9yRWFjaCgocm93LCB4KSA9PiB7XG4gICAgICAgICAgICBjb25zdCByb3dFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICByb3dFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3JvdycpO1xuICAgICAgICAgICAgcm93LmZvckVhY2goKGNlbGwsIHkpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBjZWxsRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgICAgIGNlbGxFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2NlbGwnKTtcbiAgICAgICAgICAgICAgICBjZWxsRWxlbWVudC5kYXRhc2V0LnggPSB4O1xuICAgICAgICAgICAgICAgIGNlbGxFbGVtZW50LmRhdGFzZXQueSA9IHk7XG4gICAgXG4gICAgICAgICAgICAgICAgLy8gQXBwbHkgZGlmZmVyZW50IGNsYXNzZXMgYmFzZWQgb24gdGhlIGNlbGwgY29udGVudFxuICAgICAgICAgICAgICAgIGlmIChjZWxsID09PSAnSCcpIHtcbiAgICAgICAgICAgICAgICAgICAgY2VsbEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnaGl0Jyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjZWxsID09PSAnUicpIHtcbiAgICAgICAgICAgICAgICAgICAgY2VsbEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgncmV2ZWFsZWQnKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzT3duQm9hcmQgJiYgY2VsbCBpbnN0YW5jZW9mIFNoaXApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gT25seSBkaXNwbGF5IHRoZSBzaGlwIGlmIGl0J3MgdGhlIHBsYXllcidzIG93biBib2FyZFxuICAgICAgICAgICAgICAgICAgICBjZWxsRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdzaGlwJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY2VsbEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnZW1wdHknKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgcm93RWxlbWVudC5hcHBlbmRDaGlsZChjZWxsRWxlbWVudCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGJvYXJkRWxlbWVudC5hcHBlbmRDaGlsZChyb3dFbGVtZW50KTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8vIE9wdGlvbmFsOiBNZXRob2QgdG8gYmluZCBjbGljayBldmVudHMgdG8gY2VsbHMgb24gYSBwbGF5ZXIncyBib2FyZFxuICAgIGJpbmRCb2FyZENsaWNrRXZlbnRzKHBsYXllciwgY2FsbGJhY2spIHtcbiAgICAgICAgY29uc3QgYm9hcmRFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7cGxheWVyfS1ib2FyZGApO1xuICAgICAgICBib2FyZEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGlmIChldmVudC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjZWxsJykpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB4ID0gZXZlbnQudGFyZ2V0LmRhdGFzZXQueDtcbiAgICAgICAgICAgICAgICBjb25zdCB5ID0gZXZlbnQudGFyZ2V0LmRhdGFzZXQueTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayh4LCB5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufTsiLCJpbXBvcnQgeyBHYW1lQ29udHJvbGxlciB9IGZyb20gXCIuL2dhbWVDb250cm9sbGVyXCI7XG5pbXBvcnQgeyBkb21Nb2R1bGUgfSBmcm9tIFwiLi9kb21Nb2R1bGVcIjtcblxuY29uc3QgZ2FtZUNvbnRyb2xsZXIgPSBuZXcgR2FtZUNvbnRyb2xsZXIoKTtcbmdhbWVDb250cm9sbGVyLnN0YXJ0R2FtZSgpO1xuXG4vLyBFeGFtcGxlOiBCaW5kIGNsaWNrIGV2ZW50cyB0byBQbGF5ZXIgMSdzIGJvYXJkIGZvciBhdHRhY2tzXG5kb21Nb2R1bGUuYmluZEJvYXJkQ2xpY2tFdmVudHMoJ3BsYXllcjInLCAoeCwgeSkgPT4ge1xuICAgIGNvbXB1dGVyLmdhbWVib2FyZC5yZWNlaXZlQXR0YWNrKHgsIHkpO1xuICAgIGRvbU1vZHVsZS51cGRhdGVCb2FyZFVJKGNvbXB1dGVyLmdhbWVib2FyZCwgJ3BsYXllcjInKTtcbn0pOyIsImltcG9ydCB7IFBsYXllciB9IGZyb20gXCIuL3BsYXllclwiO1xuaW1wb3J0IHsgZG9tTW9kdWxlIH0gZnJvbSBcIi4vZG9tTW9kdWxlXCI7XG5pbXBvcnQgeyBTaGlwIH0gZnJvbSBcIi4vc2hpcFwiO1xuXG5leHBvcnQgY2xhc3MgR2FtZUNvbnRyb2xsZXIge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmh1bWFuUGxheWVyID0gbmV3IFBsYXllcignaHVtYW4nKTtcbiAgICAgICAgdGhpcy5jb21wdXRlclBsYXllciA9IG5ldyBQbGF5ZXIoJ2NvbXB1dGVyJyk7XG4gICAgICAgIHRoaXMuY3VycmVudFBsYXllciA9IHRoaXMuaHVtYW5QbGF5ZXI7IC8vIEh1bWFuIHN0YXJ0cyBmaXJzdFxuICAgIH1cblxuICAgIC8vIE1ldGhvZCB0byBzdGFydCB0aGUgZ2FtZVxuICAgIHN0YXJ0R2FtZSgpIHtcbiAgICAgICAgZG9tTW9kdWxlLnJlbmRlckhvbWVTY3JlZW4oKTtcbiAgICAgICAgdGhpcy5odW1hblBsYXllci5nYW1lYm9hcmQucGxhY2VTaGlwKG5ldyBTaGlwKDUpLCAyLDIsICdyaWdodCcpO1xuICAgICAgICB0aGlzLmh1bWFuUGxheWVyLmdhbWVib2FyZC5wbGFjZVNoaXAobmV3IFNoaXAoNCksIDUsNCwgJ2Rvd24nKTtcbiAgICAgICAgdGhpcy5odW1hblBsYXllci5nYW1lYm9hcmQucGxhY2VTaGlwKG5ldyBTaGlwKDMpLCA4LDcsICdyaWdodCcpO1xuICAgICAgICB0aGlzLmh1bWFuUGxheWVyLmdhbWVib2FyZC5wbGFjZVNoaXAobmV3IFNoaXAoMyksIDAsMCwgJ2Rvd24nKTtcbiAgICAgICAgdGhpcy5odW1hblBsYXllci5nYW1lYm9hcmQucGxhY2VTaGlwKG5ldyBTaGlwKDIpLCA2LDYsICdkb3duJyk7XG4gICAgICAgIHRoaXMudXBkYXRlVUkoKTtcblxuICAgICAgICAvLyBCaW5kIGNsaWNrIGV2ZW50cyBmb3IgdGhlIGh1bWFuIHBsYXllciB0byBhdHRhY2sgdGhlIGNvbXB1dGVyJ3MgYm9hcmRcbiAgICAgICAgZG9tTW9kdWxlLmJpbmRCb2FyZENsaWNrRXZlbnRzKCdwbGF5ZXIyJywgKHgsIHkpID0+IHtcbiAgICAgICAgICAgIHRoaXMuaHVtYW5UdXJuKHgsIHkpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBIdW1hbiBwbGF5ZXIncyB0dXJuXG4gICAgaHVtYW5UdXJuKHgsIHkpIHtcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudFBsYXllciAhPT0gdGhpcy5odW1hblBsYXllcikgcmV0dXJuO1xuXG4gICAgICAgIHRoaXMuaHVtYW5QbGF5ZXIuZ2FtZWJvYXJkLnJlY2VpdmVBdHRhY2soeCwgeSk7XG4gICAgICAgIHRoaXMudXBkYXRlVUkoKTtcblxuICAgICAgICBpZiAodGhpcy5odW1hblBsYXllci5nYW1lYm9hcmQuaXNHYW1lb3ZlcigpKSB7XG4gICAgICAgICAgICBhbGVydChcIllvdSB3aW4hIEFsbCBlbmVteSBzaGlwcyBoYXZlIGJlZW4gc3Vuay5cIik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmN1cnJlbnRQbGF5ZXIgPSB0aGlzLmNvbXB1dGVyUGxheWVyO1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMuY29tcHV0ZXJUdXJuKCksIDEwMDApOyAvLyBTbGlnaHQgZGVsYXkgZm9yIGNvbXB1dGVyJ3MgdHVyblxuICAgIH1cblxuICAgIC8vIENvbXB1dGVyIHBsYXllcidzIHR1cm5cbiAgICBjb21wdXRlclR1cm4oKSB7XG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRQbGF5ZXIgIT09IHRoaXMuY29tcHV0ZXJQbGF5ZXIpIHJldHVybjtcblxuICAgICAgICBsZXQgeCwgeTtcbiAgICAgICAgZG8ge1xuICAgICAgICAgICAgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRoaXMuaHVtYW5QbGF5ZXIuZ2FtZWJvYXJkLnNpemUpO1xuICAgICAgICAgICAgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRoaXMuaHVtYW5QbGF5ZXIuZ2FtZWJvYXJkLnNpemUpO1xuICAgICAgICB9IHdoaWxlICh0aGlzLmh1bWFuUGxheWVyLmdhbWVib2FyZC5ib2FyZFt4XVt5XSAhPT0gbnVsbCk7IC8vIEF2b2lkIHJlcGVhdGluZyBhdHRhY2tzXG5cbiAgICAgICAgdGhpcy5jb21wdXRlclBsYXllci5nYW1lYm9hcmQucmVjZWl2ZUF0dGFjayh4LCB5KTtcbiAgICAgICAgdGhpcy51cGRhdGVVSSgpO1xuXG4gICAgICAgIGlmICh0aGlzLmNvbXB1dGVyUGxheWVyLmdhbWVib2FyZC5pc0dhbWVvdmVyKCkpIHtcbiAgICAgICAgICAgIGFsZXJ0KFwiQ29tcHV0ZXIgd2lucyEgQWxsIHlvdXIgc2hpcHMgaGF2ZSBiZWVuIHN1bmsuXCIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5jdXJyZW50UGxheWVyID0gdGhpcy5odW1hblBsYXllcjsgLy8gU3dpdGNoIGJhY2sgdG8gdGhlIGh1bWFuIHBsYXllcidzIHR1cm5cbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgdGhlIFVJIGZvciBib3RoIGJvYXJkc1xuICAgIHVwZGF0ZVVJKCkge1xuICAgICAgICBkb21Nb2R1bGUudXBkYXRlQm9hcmRVSSh0aGlzLmh1bWFuUGxheWVyLmdhbWVib2FyZCwgJ3BsYXllcjEnLCB0cnVlKTtcbiAgICAgICAgZG9tTW9kdWxlLnVwZGF0ZUJvYXJkVUkodGhpcy5jb21wdXRlclBsYXllci5nYW1lYm9hcmQsICdwbGF5ZXIyJywgZmFsc2UpO1xuICAgIH1cbn1cbiJdLCJuYW1lcyI6WyJTaGlwIiwiY29uc3RydWN0b3IiLCJsZW5ndGgiLCJ0aGlzIiwibnVtT2ZIaXRzIiwiaXNTdW5rIiwicG9zaXRpb25zIiwic2V0UG9zaXRpb25zIiwiaGl0IiwiY2hlY2tJc1N1bmsiLCJnZXRJc1N1bmsiLCJHYW1lYm9hcmQiLCJzaXplIiwiYm9hcmQiLCJjcmVhdGVCb2FyZCIsIm51bU9mU2hpcHMiLCJudW1PZlN1bmtlbiIsInNoaXBzIiwiaSIsIkFycmF5IiwiZmlsbCIsInBsYWNlU2hpcCIsInNoaXAiLCJ4IiwieSIsImRpcmVjdGlvbiIsInNoaXBMZW5ndGgiLCJFcnJvciIsInB1c2giLCJyZWNlaXZlQXR0YWNrIiwiY2VsbCIsImluY3JlbWVudFN1bmtlbiIsImlzR2FtZW92ZXIiLCJsb2dCb2FyZCIsImNvbnNvbGUiLCJsb2ciLCJyb3ciLCJtYXAiLCJqb2luIiwibG9nQm9hcmRUYWJsZSIsInRhYmxlIiwiUGxheWVyIiwidHlwZSIsImluaXRDb21wdGVyIiwiaW5pdFBsYXllciIsImdhbWVib2FyZCIsImZvckVhY2giLCJwbGFjZWQiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJlcnJvciIsImRvbU1vZHVsZSIsInJlbmRlckhvbWVTY3JlZW4iLCJib2R5IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiaW5uZXJIVE1MIiwiaGVhZGVyIiwiY3JlYXRlRWxlbWVudCIsImlubmVyVGV4dCIsImFwcGVuZENoaWxkIiwiZ2FtZUNvbnRhaW5lciIsImNsYXNzTGlzdCIsImFkZCIsInBsYXllcjFDb250YWluZXIiLCJwbGF5ZXIxTGFiZWwiLCJwbGF5ZXIxQm9hcmQiLCJpZCIsInBsYXllcjJDb250YWluZXIiLCJwbGF5ZXIyTGFiZWwiLCJwbGF5ZXIyQm9hcmQiLCJ1cGRhdGVCb2FyZFVJIiwicGxheWVyIiwiaXNPd25Cb2FyZCIsImJvYXJkRWxlbWVudCIsImdldEVsZW1lbnRCeUlkIiwicm93RWxlbWVudCIsImNlbGxFbGVtZW50IiwiZGF0YXNldCIsImJpbmRCb2FyZENsaWNrRXZlbnRzIiwiY2FsbGJhY2siLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJ0YXJnZXQiLCJjb250YWlucyIsImh1bWFuUGxheWVyIiwiY29tcHV0ZXJQbGF5ZXIiLCJjdXJyZW50UGxheWVyIiwic3RhcnRHYW1lIiwidXBkYXRlVUkiLCJodW1hblR1cm4iLCJhbGVydCIsInNldFRpbWVvdXQiLCJjb21wdXRlclR1cm4iLCJjb21wdXRlciJdLCJzb3VyY2VSb290IjoiIn0=